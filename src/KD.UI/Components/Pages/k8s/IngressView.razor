@inherits BaseView

<MudElement HtmlTag="div">
    @if (State.Value.TabMapping.ContainsKey(Tab))
    {
        var view = State.Value.TabMapping[Tab];
        var items = view.Items.AsQueryable();

        if (!string.IsNullOrWhiteSpace(SearchText))
        {
            items = items.Where(x => x.Name.Contains(SearchText, StringComparison.InvariantCultureIgnoreCase));
        }

        <GridHeader Label="Ingresses" View="view" OnRefresh="Fetch" OnSearch="PerformSearch" ItemCount="@items.Count()" RefreshTimer="Timer">
        </GridHeader>
        <MudDataGrid Items="items" T="IngressViewModel" SortMode="SortMode.Single" RowContextMenuClick="ContextMenuClick" Hover="true" ColumnResizeMode="ResizeMode.Column" FixedHeader="true" Height="@BaseView.TableHeight">
            <Columns>
                <TemplateColumn Title="Name" SortBy="x => x.Name" Sortable="true">
                    <CellTemplate>
                        <button @onclick="@(() => OpenProperties(context.Item))">
                            @context.Item.Name
                        </button>
                    </CellTemplate>
                </TemplateColumn>
                <PropertyColumn Property="x => x.Namespace"></PropertyColumn>
                <TemplateColumn Title="Rules">
                    <CellTemplate>
                        <ol>
                            @foreach (var rule in context.Item.Rules)
                            {
                                <li>
                                    <a role="button" class="mud-typography mud-link mud-primary-text mud-link-underline-hover cursor-pointer" @onclick="@((e) => OpenInNewWindow(rule))">
                                        @rule
                                    </a>
                                </li>
                            }
                        </ol>
                    </CellTemplate>
                </TemplateColumn>
                <TemplateColumn Title="Load Balancers">
                    <CellTemplate>
                        <ol>
                            @foreach (var lb in context.Item.LoadBalancers)
                            {
                                <li>@lb</li>
                            }
                        </ol>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
        <MudMenu @ref="_contextMenu" PositionAtCursor="true">
            @if (_contextRow != null)
            {
                <MudMenuItem Icon="@Icons.Material.Outlined.ContentCopy" OnClick="(e) => CopyToClipboard(_contextRow.Name)">Copy @_contextRow.Name</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Outlined.ContentCopy" OnClick="(e) => CopyToClipboard(_contextRow.Namespace)">Copy @_contextRow.Namespace</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Outlined.Edit" OnClick="(e) => OpenEditor(Tab, _contextRow.Name, _contextRow.Namespace)">Edit @_contextRow.Name</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.DeleteForever" IconColor="Color.Error">Delete @_contextRow.Name</MudMenuItem>
            }
        </MudMenu>
    }
</MudElement>