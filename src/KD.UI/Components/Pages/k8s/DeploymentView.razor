@inherits BaseView

<MudElement HtmlTag="div">
    @if (!State.Value.IsLoading)
    {
        if (State.Value.TabMapping.ContainsKey(Tab))
        {
            var view = State.Value.TabMapping[Tab];
            var items = view.Items.AsQueryable();

            if (!string.IsNullOrWhiteSpace(SearchText))
            {
                items = items.Where(x => x.Name.Contains(SearchText, StringComparison.InvariantCultureIgnoreCase));
            }

            <GridHeader Label="Deployments" View="view" OnRefresh="Fetch" OnSearch="PerformSearch" ItemCount="@items.Count()">
            </GridHeader>
            <MudDataGrid Items="items" T="DeploymentViewModel" SortMode="SortMode.Single" RowContextMenuClick="ContextMenuClick" Hover="true">
                <Columns>
                    <TemplateColumn Title="Name" SortBy="x => x.Name" Sortable="true">
                        <CellTemplate>
                            <button @onclick="@(() => OpenProperties(context.Item))">
                                @context.Item.Name
                            </button>
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Property="x => x.Namespace"></PropertyColumn>
                    <TemplateColumn Title="Replicas" Sortable="true">
                        <CellTemplate>
                            @{
                                var colour = context.Item.Replicas == context.Item.AvailableReplicas
                                    ? Color.Success
                                    : Color.Warning;
                            }
                            <MudText Color="@colour">@context.Item.Replicas</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Property="x => x.ReadyReplicas"></PropertyColumn>
                    <PropertyColumn Property="x => x.AvailableReplicas"></PropertyColumn>
                    <PropertyColumn Property="x => x.UnavailableReplicas"></PropertyColumn>
                    <PropertyColumn Property="x => x.TerminatingReplicas"></PropertyColumn>
                    <TemplateColumn Title="Updated Replicas" Sortable="true">
                        <CellTemplate>
                            @{
                                var colour = context.Item.Replicas == context.Item.UpdatedReplicas
                                ? Color.Success
                                : Color.Warning;
                            }
                            <MudText Color="@colour">@context.Item.UpdatedReplicas</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
            </MudDataGrid>
            <MudMenu @ref="_contextMenu" PositionAtCursor="true">
                <MudMenuItem Icon="@Icons.Material.Outlined.ContentCopy" OnClick="(e) => CopyToClipboard(_contextRow.Name)">Copy @_contextRow.Name</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Outlined.ContentCopy" OnClick="(e) => CopyToClipboard(_contextRow.Namespace)">Copy @_contextRow.Namespace</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Outlined.Edit" OnClick="(e) => OpenEditor(Tab, _contextRow.Name, _contextRow.Namespace)">Edit @_contextRow.Name</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.DeleteForever" IconColor="Color.Error">Delete @_contextRow.Name</MudMenuItem>
            </MudMenu>
        }
    }
</MudElement>

