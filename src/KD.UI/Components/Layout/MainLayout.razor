@inherits FluxorLayout

<MudThemeProvider IsDarkMode="true" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<Fluxor.Blazor.Web.StoreInitializer />

<ErrorBoundary>
    <MudLayout>
        <MudDrawer Open="true" Anchor="Anchor.Left" Variant="DrawerVariant.Persistent" Width="15%">
            <ConfigBlock />
            <ContextBlock />
            <NamespaceBlock />
            <ObjectNavigationMenuBlock />
        </MudDrawer>
        <PropertiesBlock />
        <MudMainContent>
            <YamlEditor />
            <Search />
            <LogViewer />
            @Body
        </MudMainContent>
        <MudOverlay Visible="OverlayState.Value.IsOpen" DarkBackground AutoClose="true" OnClosed="OnClosed" />
    </MudLayout>
</ErrorBoundary>

@code {
    [Inject]
    private IState<OverlayViewState> OverlayState { get; set; }

    [Inject]
    public IDispatcher Dispatcher { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
    }

    private void OnClosed()
    {
        if (OverlayState.Value.CloseAction != null)
        {
            Dispatcher.Dispatch(OverlayState.Value.CloseAction);
        }
    }
}